#!/usr/bin/env ruby

require File.expand_path('../../config/environment', __FILE__)

plugins = Dir[ File.expand_path('../../plugins/*.rb', __FILE__) ].map do |rb|
  load rb
  File.basename(rb).sub(/\.rb$/,'').classify.constantize
end

bot = Cinch::Bot.new do
  configure do |c|
    c.server          = Bot.config.server
    c.nick            = Bot.debug? ? "#{Bot.config.nick}_test" : Bot.config.nick
    c.channels        = [Bot.config.channel]
    c.verbose         = true
    c.plugins.plugins = plugins
  end
end

#Thread.new { listen to something }
Signal.trap("USR1") do
  bot.dispatch :good_bye # this quits
end

Thread.new { Cijoe::Server.listen(bot, Bot.config.channel) }

bot.start
